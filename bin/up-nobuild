#!/bin/bash

set -e

. ./bin/include/versioning
. ./.envrc

export DOCKER_IMAGE_TAG=${VERSION_TAG}

if [ -z "$SKIP_IMAGE" ]; then
  if [ ! -f "binaries/cf-operator_linux_amd64" ]; then
    bin/build-cross-compilation
  fi
  bin/build-nobuild-image
fi

bin/build
bin/apply-crds
echo "watching namespace ${CF_OPERATOR_NAMESPACE}"
binaries/cf-operator
